<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="utf-8" />
  <!-- 30% smaller safely (no transform) -->
  <meta name="viewport" content="width=device-width, initial-scale=0.7, maximum-scale=0.7, user-scalable=no" />
  <title>PRANIMI</title>
  <style>
    :root{
      /* same neon look */
      --bg:#05060d; --fg:#eaf0ff; --muted:#9fb0d9;
      --panel: rgba(10,12,25,.62); --panel-border: rgba(120,150,255,.18);
      --glass: rgba(18,22,46,.55); --line: rgba(120,150,255,.20);
      --btn: rgba(24,34,78,.92); --btn-br: rgba(124,168,255,.45);
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:radial-gradient(1000px 560px at 10% -10%, rgba(124,59,255,.22), transparent 60%), radial-gradient(900px 520px at 98% -15%, rgba(59,232,255,.18), transparent 60%), var(--bg); color:var(--fg); font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial}
    .wrap{ max-width: 960px; margin: 0 auto; padding: 0 16px 120px; }
    h1{ font-size: clamp(28px, 4vw, 42px); margin: 22px 18px 14px; letter-spacing:.03em; display:flex; align-items:center; gap:12px }
    .badge{ display:inline-flex; gap:10px; align-items:center; background: linear-gradient(90deg, rgba(124,59,255,.28), rgba(59,232,255,.28)); border:1px solid var(--panel-border); border-radius:999px; padding:8px 14px; font-weight:800; letter-spacing:.08em; font-size:12px }
    .card{ background: linear-gradient(180deg, rgba(10,12,25,.62), rgba(6,9,20,.72)); border:1px solid var(--panel-border); border-radius:18px; padding:16px; margin:16px 0; backdrop-filter: blur(8px) }
    .title{ display:flex; align-items:center; gap:12px; font-size: clamp(18px, 2.2vw, 22px); font-weight: 900; letter-spacing:.04em; margin-bottom: 12px }
    label{ font-size:12px; color:var(--muted); letter-spacing:.08em }
    .row{ display:grid; grid-template-columns: 1fr 1fr; gap:12px }
    @media (max-width:640px){ .row{ grid-template-columns:1fr } }
    .input{ background: rgba(14,20,44,.82); border:1px solid var(--line); border-radius: 14px; padding: 14px 16px; color:var(--fg); font-size: 16px; outline: none }
    .chips{ display:flex; gap:10px; overflow-x:auto; -webkit-overflow-scrolling:touch; padding:6px 0 10px }
    .chip{ flex:0 0 auto; border:1px solid rgba(120,150,255,.35); background: linear-gradient(180deg, rgba(16,24,56,.88), rgba(10,16,40,.88)); color:#e9f2ff; border-radius:12px; padding:10px 14px; font-weight:900 }
    .list{ display:flex; flex-direction:column; gap:10px; margin-top:8px }
    .piece-row{ display:grid; grid-template-columns: 80px 1fr 120px; gap:8px; align-items:center }
    .piece-id{ background: linear-gradient(180deg, rgba(18,26,60,.9), rgba(10,18,38,.9)); border:1px solid var(--panel-border); border-radius:12px; padding:12px 14px; text-align:center; font-weight:900; letter-spacing:.08em }
    .btnbar{ display:flex; gap:10px; flex-wrap:wrap; margin-top:8px }
    .btn{ border:1px solid var(--btn-br); background: linear-gradient(180deg, var(--btn), rgba(16,26,56,.9)); color:#fff; border-radius:12px; padding:12px 16px; font-weight:900; letter-spacing:.06em }
    .btn.red{ border-color: rgba(255,90,172,.45); background: linear-gradient(180deg, rgba(64,10,26,.9), rgba(48,8,20,.9)) }
    .tot{ display:flex; justify-content:space-between; align-items:center; background: rgba(18,22,46,.55); border:1px solid var(--panel-border); border-radius:12px; padding:10px 12px; margin-top:10px }
    .pill{ background: rgba(18,22,46,.55); border:1px solid var(--panel-border); border-radius:12px; padding:10px 12px }
    /* Footer fixed, but safe for taps */
    body{ padding-bottom: 110px; }
    .footer{ position: fixed; min-height: 72px; left:0; right:0; bottom:0; z-index: 10; backdrop-filter: blur(6px); background: linear-gradient(180deg, rgba(6,8,18,.1), rgba(6,8,18,.65)); padding-top: 6px; pointer-events: none; }
    .footwrap{ max-width: 960px; margin: 0 auto; padding: 0 16px; display:grid; grid-template-columns:1fr auto auto; gap:10px; align-items:center }
    .footwrap .btn, .footwrap .pill{ pointer-events: auto; }
    /* payments colors */
    b#euroTotal{ color:#9fd3ff } b#borxhi{ color:#ff8aa0 } b#kthimi{ color:#8dffa2 }
    #paidChips .btn{ height:36px; padding:0 10px; font-weight:800 }
  </style>
</head>
<body>
  <h1>PRANIMI <span class="badge">NEON â€¢ FUTURE</span></h1>
  <input type="hidden" id="orderId" value="">
  <div class="wrap">

    <!-- KLIENTI -->
    <section class="card">
      <div class="title">Hapi 1 â€” Klienti <img id="clientThumb" alt="" style="width:36px;height:36px;border-radius:6px;margin-left:6px;object-fit:cover;border:1px solid var(--panel-border);display:none"></div>
      <div class="row">
        <div>
          <label>EMRI &amp; MBIEMRI*</label>
          <div style="display:flex;align-items:center;gap:6px;">
            <input class="input" id="name" placeholder="p.sh. Arben R.">
            <label title="Foto klientit" style="display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:8px;border:1px solid var(--panel-border);background:linear-gradient(180deg,rgba(24,34,78,.9),rgba(16,26,56,.9));cursor:pointer">
              <span style="font-size:13px">ðŸ“·</span>
              <input type="file" accept="image/*" capture="environment" id="clientPhotoInput" style="display:none">
            </label>
          </div>
        </div>
        <div>
          <label>TELEFONI*</label>
          <div class="row" style="grid-template-columns:110px 1fr">
            <input class="input" id="phonePrefix" value="+383" readonly>
            <input class="input" id="phone" inputmode="numeric" placeholder="44177778">
          </div>
        </div>
      </div>
    </section>

    <!-- TEPIHA -->
    <section class="card" id="sec-tepiha">
      <div class="title">Tepiha</div>
      <div class="chips" id="chips-tepiha">
        <button class="chip">2.0 mÂ²</button><button class="chip">2.5 mÂ²</button><button class="chip">3.0 mÂ²</button><button class="chip">3.2 mÂ²</button><button class="chip">3.5 mÂ²</button><button class="chip">3.7 mÂ²</button><button class="chip">6.0 mÂ²</button><button class="chip">Manual</button>
      </div>
      <div class="list" id="list-tepiha"></div>
      <div class="btnbar"><button class="btn" onclick="addRow('tepiha', null)">+ Rresht</button><button class="btn red" onclick="removeRow('tepiha')">âˆ’ Rresht</button></div>
      <div class="tot"><span>Totali tepiha:</span><b id="tot-tepiha">0.00 mÂ²</b></div>
    </section>

    <!-- STAZA -->
    <section class="card" id="sec-staza">
      <div class="title">Staza</div>
      <div class="chips" id="chips-staza">
        <button class="chip">1.5 mÂ²</button><button class="chip">2.0 mÂ²</button><button class="chip">2.2 mÂ²</button><button class="chip">3.0 mÂ²</button><button class="chip">Manual</button>
      </div>
      <div class="list" id="list-staza"></div>
      <div class="btnbar"><button class="btn" onclick="addRow('staza', null)">+ Rresht</button><button class="btn red" onclick="removeRow('staza')">âˆ’ Rresht</button></div>
      <div class="tot"><span>Totali staza:</span><b id="tot-staza">0.00 mÂ²</b></div>
    </section>

    <!-- SHKALLORE -->
    <section class="card" id="sec-shkallore">
      <div class="title">Shkallore</div>
      <div class="row">
        <div><label>Sasia (numri i hapave)</label><input class="input" id="stairsQty" inputmode="numeric" placeholder="p.sh. 20"></div>
        <div><label>MÂ² pÃ«r hap</label><input class="input" id="stairsPer" inputmode="decimal" value="0.3"></div>
      </div>
      <div class="tot"><span>MÂ² shkallore:</span><b id="stairsM2">0.00 mÂ²</b></div>
    </section>

    <!-- PAGESA -->
    <section class="card">
      <div class="title">Pagesa</div>
      <div class="row">
        <div><label>â‚¬ / mÂ²</label><input class="input" id="rate" inputmode="decimal" value="2.50"></div>
        <div>
          <label>PAGUAR NÃ‹ FILLIM (CASH)</label><br>
          <label style="display:flex;align-items:center;gap:10px"><input type="checkbox" id="paidUpfront"><span>Aktivo pÃ«r tÃ« futur shumÃ«n e dhÃ«nÃ«</span></label>
        </div>
      </div>
      <div class="row">
        <div><label>KLIENTI DHA (â‚¬)</label><input class="input" id="clientPaid" inputmode="decimal" placeholder="p.sh. 15" disabled></div>
        <div><label>BORXHI (â‚¬)</label><input class="input" id="debt" readonly></div>
      </div>
      <div class="row">
        <div class="pill"><b>MÂ² total:</b> <span id="m2Total">0.00</span></div>
        <div class="pill"><b>Total (â‚¬):</b> <span id="euroTotal">0.00</span></div>
      </div>
    </section>

    <!-- FOOTER -->
    <div class="footer">
      <div class="footwrap">
        <div class="pill"><b>Totali:</b> <span id="m2TotalFooter">0.00</span> mÂ²</div>
        <button class="btn" id="btnSaveDraft">ðŸ’¾ RUAJ DRAFT</button>
        <a class="btn" id="btnContinue" href="../pastrimi/">â–¶ VAZHDO</a>
      </div>
    </div>
  </div>

  <!-- Minimal, safe scripts: no global click capture, no preventDefault -->
  <script>
    (function(){
      function q(s,b){ return (b||document).querySelector(s); }
      function qq(s,b){ return Array.from((b||document).querySelectorAll(s)); }
      function round2(x){ return Math.round((x + Number.EPSILON) * 100)/100; }

      function listFor(section){ return q('#list-'+section); }

      window.addRow = function(section, value){
        const list = listFor(section);
        const row = document.createElement('div'); row.className = 'piece-row';
        const id = document.createElement('div'); id.className = 'piece-id';
        const idx = qq('.piece-row', list).length + 1; id.textContent = '#' + String(idx).padStart(2,'0');
        const inp = document.createElement('input'); inp.className = 'input piece-input'; inp.placeholder='mÂ²'; inp.inputMode='decimal';
        if (value != null) inp.value = value;
        const qty = document.createElement('input'); qty.className = 'input piece-qty'; qty.placeholder='copÃ«'; qty.inputMode='numeric'; qty.value='1';
        inp.addEventListener('input', computeTotals); qty.addEventListener('input', computeTotals);
        row.appendChild(id); row.appendChild(inp); row.appendChild(qty); list.appendChild(row);
        computeTotals();
      }

      window.removeRow = function(section){
        const list = listFor(section);
        const rows = qq('.piece-row', list);
        if(rows.length){ rows[rows.length-1].remove(); computeTotals(); }
      }

      function sectionTotal(section){
        const list = listFor(section);
        const rows = qq('.piece-row', list);
        const total = round2(rows.reduce((s,row)=>{
          const m2 = parseFloat((row.querySelector('.piece-input')||{}).value||'0')||0;
          const qv = parseFloat((row.querySelector('.piece-qty')||{}).value||'1')||1;
          return s + (m2*qv);
        }, 0));
        const tgt = q('#tot-'+section); if (tgt) tgt.textContent = total.toFixed(2) + ' mÂ²';
        return total;
      }

      function computeStairs(){
        const qty = parseFloat(q('#stairsQty').value||'0')||0;
        const per = parseFloat(q('#stairsPer').value||'0.3')||0;
        const m2 = round2(qty * per); q('#stairsM2').textContent = m2.toFixed(2) + ' mÂ²';
        return m2;
      }

      window.computeTotals = function computeTotals(){
        const tT = sectionTotal('tepiha');
        const tS = sectionTotal('staza');
        const tStairs = computeStairs();
        const totalM2 = round2(tT + tS + tStairs);
        q('#m2Total').textContent = totalM2.toFixed(2);
        q('#m2TotalFooter').textContent = totalM2.toFixed(2);
        const rate = parseFloat(q('#rate').value||'0')||0;
        const euro = round2(totalM2 * rate);
        q('#euroTotal').textContent = euro.toFixed(2);

        const paidUp = q('#paidUpfront').checked;
        const paidVal = paidUp ? (parseFloat(q('#clientPaid').value||'0')||0) : 0;
        q('#clientPaid').disabled = !paidUp;
        if(!paidUp) q('#clientPaid').value = '';
        const debt = Math.max(0, round2(euro - paidVal));
        q('#debt').value = debt.toFixed(2);
      }

      // Wire inputs
      ['#stairsQty','#stairsPer','#rate','#paidUpfront','#clientPaid'].forEach(sel=>{
        const el = q(sel); if(!el) return;
        el.addEventListener(sel==='#paidUpfront' ? 'change' : 'input', computeTotals);
      });
      // Chips
      function wireChips(containerId, section){
        qq('#'+containerId+' .chip').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const txt=(btn.textContent||'').trim(); const num=parseFloat(txt.replace(/[^\d\.]/g,'')); 
            if(!isNaN(num)) addRow(section, num); else addRow(section, null);
          });
        });
      }
      wireChips('chips-tepiha','tepiha'); wireChips('chips-staza','staza');

      // Draft save (localStorage) and continue
      const LIST_KEY = 'order_list_v1'; const KEY = id => `order_${id}`;
      function getId(){ const hid=q('#orderId'); if(hid.value) return hid.value; const id='ord_'+Date.now(); hid.value=id; return id; }
      function readRows(listId){
        const list=q('#list-'+listId); if(!list) return [];
        return qq('.piece-row', list).map(row=>({
          m2: parseFloat(row.querySelector('.piece-input')?.value||'0')||0,
          qty: parseFloat(row.querySelector('.piece-qty')?.value||'1')||1
        }));
      }
      function totals(){
        const m2=parseFloat(q('#m2Total').textContent||'0')||0;
        const rate=parseFloat(q('#rate').value||'0')||0;
        const euro=Math.round(m2*rate*100)/100;
        const paidUp=q('#paidUpfront').checked;
        const paid=paidUp?(parseFloat(q('#clientPaid').value||'0')||0):0;
        const debt=Math.max(0, euro-paid);
        const change=Math.max(0, paid-euro);
        return {m2, rate, euro, paidUp, paid, debt, change};
      }
      function saveIndexEntry(id, name, phone){
        let idx=[]; try{ idx=JSON.parse(localStorage.getItem(LIST_KEY)||'[]'); }catch(e){ idx=[]; }
        const i=idx.findIndex(x=>x.id===id);
        const entry={id, name:name.trim(), phone:phone.trim()};
        if(i>=0) idx[i]=entry; else idx.unshift(entry);
        localStorage.setItem(LIST_KEY, JSON.stringify(idx.slice(0,200)));
      }
      function saveDraft(){
        const id=getId();
        const name=q('#name')?.value||'';
        const phone=`${q('#phonePrefix')?.value||''}${(q('#phone')?.value||'').trim()}`;
        const data={
          id, ts:Date.now(),
          client:{name, phone},
          tepiha: readRows('tepiha'),
          staza: readRows('staza'),
          shkallore:{ qty: parseFloat(q('#stairsQty')?.value||'0')||0, per: parseFloat(q('#stairsPer')?.value||'0.3')||0 },
          pay: totals(),
          status:'pranim',
        };
        try{
          localStorage.setItem(KEY(id), JSON.stringify(data));
          saveIndexEntry(id, name, phone);
          return true;
        }catch(e){ alert('Sâ€™u ruajt dot drafti (localStorage i plotÃ«?)'); return false; }
      }
      const btnSave=q('#btnSaveDraft'); if(btnSave){ btnSave.addEventListener('click', (e)=>{ e.preventDefault(); saveDraft(); }); }
      // NOTE: Continue is a normal <a href="../pastrimi/">; no JS needed.
      computeTotals();
    })();
  </script>
</body>
</html>